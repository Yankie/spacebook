---
title: Физическая верификация и экстракция проекта средствами САПР Mentor Graphics Calibre
permalink: /calibre/
eleventyNavigation:
   parent: ug
   key: calibre
   order: 90
   title: Физическая верификация и экстракция проекта средствами САПР Mentor Graphics Calibre
---


В данном разделе описан маршрут проведения физической верификации и экстракции проекта с использованием графического интерфейса САПР `Mentor Graphics Calibre`. Использование данного маршрута предполагает интеграцию `Calibre` в среду `Cadence Virtuoso`.

Для интеграции меню `Calibre` в окно редактора топологии `Virtuoso Layout Editor` необходимо в файл `.cdsinit` (находящийся либо в домашнем каталоге пользователя, либо в каталоге, откуда производится запуск `Cadence`) добавить следующую строку:

```lisp
load( strcat( getShellEnvVar("MGC_HOME") "/shared/pkgs/icv/tools/queryskl/calibre.skl" ) )
```

Предварительно следует проверить наличие и правильность значения переменной окружения `MGC_HOME`, содержащей путь к установленному пакету САПР `Mentor Graphics`.

По умолчанию меню `Calibre` будет добавляться только при открытии стандартного топологического представления ячейки (`maskLayout`) в окне редактора `Virtuoso Layout Editor`. Чтобы меню `Calibre` было доступно и при открытии других типов топологических представлений в различных редакторах (например, параметризованных ячеек или топологии в редакторе `Virtuoso XL Layout`) необходимо указать их с помощью переменной `mgcCalibreMenuViewType` до загрузки скрипта `calibre.skl`. Ниже приведен пример установок в файле `.cdsinit` для подключения меню Calibre при использовании наиболее распространенных типов топологических представлений и редакторов:

```lisp
mgcCalibreMenuViewType = list("maskLayout" "maskLayoutXL" "maskLayoutParamCell")

load( strcat( getShellEnvVar("MGC_HOME") "/shared/pkgs/icv/tools/queryskl/calibre.skl" ) )
```

Стоит отметить, что указанные выше настройки уже включены в файл `.cdsinit`, входящий в состав данного КСП (`./<имя_КСП>/PDK_<версия_КСП>/env/.cdsinit`). Поэтому при использовании поставляемых вместе с КСП файлов настройки меню Calibre будет интегрировано в `Cadence Virtuoso` автоматически. Более подробная информация об интеграции `Calibre` в среду `Cadence Virtuoso` содержится в соответствующем разделе документации `Calibre Interactive User's Manual` по САПР `Mentor Graphics Calibre`.

Перед началом работы с `Calibr`e необходимо убедиться в наличии и правильности указания пути к файлу трансляции топологии в calibre (при использовании поставляемых вместе с КСП файлов настройки данный путь будет прописан автоматически). Для этого в окне `Virtuoso Layout Editor` необходимо выбрать пункт меню `Calibre -> Setup -> Layout Export…`. После этого появится форма для задания настроек трансляции топологии. В поле `Layer Map File` должен быть задан путь к файлу трансляции топологии (файл `streamInOut.map` в структуре КСП). Только после этого можно переходить непосредственно к работе с `Calibre`.

![Изображение](/content/images/ug/9_1.png)

## Проверка топологии на соответствие КТО (DRC-проверка)

Для DRC-проверки проекта с помощью Calibre необходимо:

1. Открыть топологию проекта в `Virtuoso Layout Editor`.
2. Выбрать в меню `Calibre -> Run DRC`.
3. В появившемся окне конфигурирования можно задать необходимые установки (ключи) для запуска DRC-проверки и нажать кнопку `OK` (например, отключить проверку плотности слоев, если на данном этапе она не актуальна). Описание ключей, используемых при DRC-проверке, приведено в разделе 9.2.
  ![Изображение](/content/images/ug/9_2.png)
4. При правильной настройке КСП поле `DRC Rules File` на вкладке `Rules` в основном окне `Calibre DRC` заполняется автоматически и не требует вмешательства пользователя. Также пользователю предлагается указать в поле `DRC Run Directory` рабочий каталог, куда `Calibre` будет помещать всю создаваемую в процессе верификации информацию, либо оставить его значение, заданное по умолчанию.
  ![Изображение](/content/images/ug/9_3.png)
5. На вкладках `Inputs`, `Outputs`, `DRC Options` (вкладка доступна после выбора пункта меню `Setup -> DRC Options`) задать все необходимые параметры для DRC-проверки: имя ячейки верхнего уровня, имена файлов отчетов, максимальное количество выводимых ошибок и т.д.
  ![Изображение](/content/images/ug/9_4.png)
6. Проверить и при необходимости включить дополнительные проверки, выключенные по умолчанию, выбрав пункт меню `Setup -> Select Checks...` .
7. Запустить DRC-проверку, нажав кнопку `Run DRC`.
8. После окончания проверки автоматически появится окно `Calibre DRC RVE`, в котором отобразятся результаты DRC-проверки.
9. При обнаружении ошибок в топологии необходимо исправить их, отредактировав топологию, после чего повторно запустить DRC-проверку и убедиться, что ошибок в топологии больше не содержится.
  ![Изображение](/content/images/ug/9_5.png)
  ![Изображение](/content/images/ug/9_6.png)

## Описание ключей, используемых при DRC-проверке

Для корректной DRC-проверки топологии в КСП предусмотрено использование следующих ключей (устанавливаются при запуске или при выборе вкладки `Customization` основного окна `Calibre DRC`):

- **Choose IP level (CHIP or BLOCK)** - предустановка ключей в зависимости от стадии разработки топологии: сборка кристалла/чипа(CHIP) или блок уровня(BLOCK). Предустановленные ключи на CHIP уровне являются обязательными для аттестации топологии.
- **Check drcANTENNA_MOS Rules** - проверка антенных правил для транзисторов (см. раздел [7.5.8 DRM]()). Проводится для слоев poly, lil, metal1 - metal6, mim5, hkmim5.  Для финализации топологии выполнение проверки обязательно.
- **Check Density Rules** - проверка правил плотности заполнения слоев (см. раздел [7.5.10.1 DRM]()). Для слоев poly, active, metal6 проверяется минимальная плотность заполнения на всем кристалле, для слоев active, metal1 - metal5 проверяются локальные минимальное и максимальное значения плотности в скользящем окне 2x2 мм. Для финализации топологии выполнение проверки обязательно.
- **Hier depth for reading port objects** - глубина иерархии при чтении из топологической базы данных меток, рассматриваемых программой LVS как порты. По умолчанию метки ищутся только на верхнем (primary) уровне иерархии обрабатываемой ячейки.
- **Hier depth for reading text objects** - глубина иерархии для текстовых меток. По умолчанию метки учитываются только на верхнем (primary) уровне.
- **Dummies Checks** - проверка правил формирования фиктивных элементов для заполнения областей (см. раздел [7.5.10.2 DRM]()). Для финализации топологии выполнение проверки обязательно.
- **Check Metal Slot Rules** - используется для проверки правил проектирования широких металлических шин. Для финализации топологии выполнение проверки  рекомендовано.
- **Check recommended 13.1f/13.1g/HTT.2a/HTT.2b/RNW2.2/RNW2.4 rules for analog use** - используется в аналоговых применениях для проверки рекомендованных значений параметров 5V транзисторов, 5V транзисторов Н-типа и NWELL2 резисторов .
- **Recommend isolating the side walls of PWELL/PWELL2 with NWELL** - рекомендуется использовать Nwell (не nwell2. изоляционные кольца для карманов pwell/pwell2,если проектом не предусмотрено другое).
- **Check Bumping Design With PRL rules** - проверка правил проектирования bumping pads. По умолчанию проверка выключена.
- **ClassPAD** - позволяет выбрать класс сборки для конкретного проекта (проверяются соответствующие ему правила). Есть два класса PAD-ов:

  - ClassWireBonding - проволочная разварка,
  - ClassFlipChip - шариковые выводы.

  По умолчанию установлен класс ClassWireBonding.
- **Check Rpolyp rules** - проверка наличия в топологии резисторов на основе P+-поликремния. Если проверка включена, то резистор rpo1p не допускается. По умолчанию проверка включена.
- **Check MicroPad Rules** - проверка правил проектирования микропадов (см. раздел [7.5.9 DRM]() и раздел 3.4.1 данного руководства). Если проверка включена, то проверяемый проект считается опытным образцом и использование микропадов разрешено, при этом выполняются соответствующие проверки правил проектирования. Если проверка выключена, то присутствие микропадов в топологии недопустимо. По умолчанию проверка выключена.

## Проверка соответствия топологии и электрической схемы (LVS-проверка)

Для проверки соответствия топологии и электрической схемы, а также последующей экстракции паразитных элементов **НЕОБХОДИМО** наличие текстовых меток с именами портов/выводов в топологии ячейки верхнего уровня (проверяемой ячейки). Метки должны быть прорисованы в слое соответствующего металла с атрибутом `pintext` и находиться непосредственно на слое данного металла (точка привязки метки должна попадать внутрь геометрии цепи).
Для LVS-проверки проекта с помощью Calibre необходимо:

1. Открыть топологию проекта в `Virtuoso Layout Editor`.
2. Выбрать в меню `Calibre -> Run LVS`.
3. В появившемся окне конфигурирования можно задать необходимые установки для запуска LVS-проверки и нажать кнопку `OK` (например, изменить точность сравнения параметров транзисторов). Описание ключей, используемых при LVS-проверке, приведено в разделе 9.4.
  ![Изображение](/content/images/ug/9_7.png)
4. При правильной настройке КСП поле `LVS Rules File` на вкладке `Rules` в основном окне `Calibre LVS` заполняется автоматически и не требует вмешательства пользователя. Также пользователю предлагается указать в поле `LVS Run Directory` рабочий каталог, куда `Calibre` будет помещать создаваемую в процессе верификации информацию, либо оставить его значение по умолчанию.
  ![Изображение](/content/images/ug/9_8.png)
5. На вкладках `Inputs`, `Outputs`, `LVS Options` (вкладка доступна после выбора пункта меню `Setup -> LVS Options`) задать все необходимые параметры для LVS-проверки: имя ячейки верхнего уровня в топологии и электрической схеме, имена файлов отчетов, максимальное количество выводимых ошибок, опции сравнения и т.д.
  ![Изображение](/content/images/ug/9_9.png)
6. Запустить LVS-проверку, нажав кнопку `Run LVS`.
7. После окончания проверки автоматически появится окно `Calibre LVS RVE`, в котором отобразятся результаты LVS-проверки (сравнения).
8. При обнаружении ошибок необходимо исправить их, отредактировав топологию или в отдельных случаях электрическую схему, после чего повторно запустить LVS-проверку и убедиться, что ошибок при сравнении больше не возникает.
  ![Изображение](/content/images/ug/9_10.png)

## Описание ключей, используемых при LVS-проверке

Для корректной LVS-проверки топологии и электрической схемы в КСП предусмотрено использование следующих ключей (устанавливаются при запуске или при выборе вкладки `Customization` основного окна `Calibre LVS`):

- **Hier depth for reading port objects** - глубина иерархии при чтении из топологической базы данных меток, рассматриваемых программой LVS как порты. По умолчанию метки ищутся только на верхнем (primary) уровне иерархии обрабатываемой ячейки.
- **Hier depth for reading text objects** - глубина иерархии для текстовых меток. По умолчанию метки учитываются только на верхнем (primary) уровне.
- **Check Erc Rules** - проверка правил электрических соединений схемы (наличие контактов к карману, подложке и т.д.). По умолчанию проверка включена.
- **Extract Diodes** - позволяет управлять экстракцией диодов из топологии. Если ключ установлен в значение `All_Diodes` при LVS-проверке экстрагируются все диоды, независимо от наличия идентификационного слоя `mdiode`. Если же ключ установлен в значение `Marked_Diodes_Only` при LVS-проверке экстрагируются только те диоды, которые покрыты слоем `mdiode`. Если ключ не установлен, то диоды при LVS-проверке не экстрагируются. По умолчанию установлено значение `Marked_Diodes_Only`.
- **LPE** - предназначен для использования дэки при паразитной экстракции. Если ключ определен, значения параметров AS, AD, PS и PD для МОП-транзисторов вычисляются в топологии и записываются в выходной нетлист (без сравнения со схемой). По умолчанию выключен.
- **Lvs Precision On Transistors/Passive Devices/Inductors (%)** - позволяет установить необходимую точность при сравнении параметров соответствующих устройств.

## Экстракция паразитных элементов топологии (xRC-экстракция)

КСП поддерживает все основные выходные форматы данных для маршрута экстракции паразитных элементов: `CALIBREVIEW`, `DSPF`, `HSPICE`, `SPECTRE` и `SPEF`.

!!!warning Примечание
   Протестированы выходные форматы CALIBREVIEW и SPECTRE.

### xRC-экстракция на примере формата "CalibreView

Для xRC-экстракции проекта с использованием "CalibreView" необходимо:

1. Открыть топологию проекта в `Virtuoso Layout Editor`.
2. Выбрать в меню `Calibre -> Run PEX`.
3. В появившемся окне конфигурирования можно задать необходимые установки для LVS-проверки, проводимой в ходе экстракции и нажать кнопку `OK`.
   ![Изображение](/content/images/ug/9_11.png)

4. При правильной настройке КСП поле `PEX Rules File` на вкладке `Rules` в основном окне `Calibre PEX` заполняется автоматически. Пользователю предлагается указать в поле `PEX Run Directory` рабочий каталог, куда Calibre будет помещать создаваемую в процессе экстракции информацию, либо оставить его значение по умолчанию.
   ![Изображение](/content/images/ug/9_12.png)

5. На вкладках `Inputs`, `Outputs` задать все необходимые параметры для экстракции: имя ячейки верхнего уровня в топологии и электрической схеме, имена файлов отчетов, максимальное количество выводимых ошибок, тип экстракции и т.д. На вкладке `Outputs` в поле `Format` необходимо задать представление `CALIBREVIEW`, а в поле `Use Names From` - `SCHEMATIC`. На вкладке `PEX Options` (доступна после выбора пункта меню `Setup -> PEX Options`) можно указать дополнительные параметры экстракции, а также требуемые опции LVS сравнения.
   ![Изображение](/content/images/ug/9_13.png)

6. Запустить экстракцию, нажав кнопку `Run PEX`.
7. После окончания экстракции автоматически появится окно `Calibre View Setup`, в котором необходимо задать путь к файлу отображения элементов `calview.cellmap`, название экстрагированного представления ячейки (`calibre_typ`) и другие настройки (рис. 9.14)
   ![Изображение](/content/images/ug/9_14.png)

8. После заполнения всех необходимых параметров в окне `Calibre View Setup` и нажатия кнопки `OK` в библиотеке появится новое представление ячейки с указанным названием (`calibre_typ` для данного примера), которое является электрической схемой, включающей как исходные, так и экстрагированные паразитные элементы.
   ![Изображение](/content/images/ug/9_15.png)

### Описание ключей, используемых при xRC-экстракции.

- **Hier depth for reading port objects** - глубина иерархии при чтении из топологической базы данных меток, рассматриваемых как порты. По умолчанию метки ищутся только на верхнем (primary) уровне иерархии обрабатываемой ячейки.
- **Hier depth for reading text objects** - глубина иерархии для текстовых меток. По умолчанию метки учитываются только на верхнем (primary) уровне.
- **Extract Diodes** - позволяет управлять экстракцией диодов из топологии. Если ключ установлен в значение `All_Diodes` при LVS-проверке экстрагируются все диоды, независимо от наличия идентификационного слоя `mdiode`. Если же ключ установлен в значение `Marked_Diodes_Only` при LVS-проверке экстрагируются только те диоды, которые покрыты слоем `mdiode`. Если ключ не установлен, то диоды при LVS-проверке не экстрагируются. По умолчанию установлено значение `Marked_Diodes_Only`.
- **LPE** - предназначен для использования дэки при паразитной экстракции. Если ключ определен, значения параметров AS, AD, PS и PD для МОП-транзисторов вычисляются в топологии и записываются в выходной нетлист (без сравнения со схемой). По умолчанию включен.
- **Lvs Precision On Transistors/Passive Devices/Inductors (%)** - позволяет установить необходимую точность при сравнении параметров соответствующих устройств.
- **xRC corner setup** - выбор угла экстракции. Возможные значения TYP, MAX, MIN. По умолчанию установлен угол TYP.

| Корнер | Толщина металла | Ширина металла | Толщина диэлектрика | Толщина VIA | Сопротивление металла | Сопротивление VIA |
|:------:|:---------------:|:--------------:|:-------------------:|:-----------:|:---------------------:|:-----------------:|
|  TYP   |       typ       |      typ       |         typ         |     typ     |          typ          |        typ        |
|  MIN   |       min       |      min       |         min         |     min     |          min          |        min        |
|  MAX   |       max       |      max       |         max         |     max     |          max          |        max        |
___
